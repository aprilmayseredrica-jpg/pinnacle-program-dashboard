<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VA-lueLens: Cancellation Analysis Dashboard</title>
    
    <!-- 1. Define MMM Colors in Tailwind Config -->
    <!-- This MUST be before the main Tailwind script -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mmm-blue': '#004a99',
                        'mmm-green': '#6abf4b',
                        'mmm-gray': {
                            100: '#f7fafc',
                            200: '#edf2f7',
                            300: '#e2e8f0',
                            800: '#2d3748',
                        },
                        'mmm-accent': '#f59e0b', // A warm accent
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        };
    </script>
    
    <!-- 2. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 3. Load ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    
    <!-- 4. Custom Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc; /* mmm-gray-100 */
        }
        /* Style for active tabs */
        .tab-btn.active {
            border-bottom-color: #004a99; /* mmm-blue */
            color: #004a99; /* mmm-blue */
            font-weight: 600;
        }
        /* Basic styling for chart containers */
        .chart-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 24px;
            height: 450px; /* Fixed height for consistency */
            display: flex;
            flex-direction: column;
        }
        .chart-title {
            font-size: 1.125rem; /* 18px */
            font-weight: 600;
            color: #004a99; /* mmm-blue */
            margin-bottom: 16px;
        }
        .apexcharts-tooltip {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            color: #2d3748;
        }
        .apexcharts-tooltip-title {
            background: #f7fafc;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-mmm-gray-100 p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-6 flex items-center space-x-3">
            <div class="w-12 h-12 bg-mmm-blue rounded-lg flex items-center justify-center shadow">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            </div>
            <div>
                <h1 class="text-3xl font-bold text-mmm-blue">VA-lueLens Dashboard</h1>
                <p class="text-lg text-mmm-gray-800">VA Cancellation Analysis (2024-2025)</p>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="mb-6 border-b border-mmm-gray-300">
            <nav class="flex flex-wrap -mb-px" id="tab-nav">
                <button class="tab-btn active text-gray-600 py-4 px-6 border-b-2 border-transparent hover:text-mmm-blue hover:border-mmm-blue focus:outline-none" data-tab="overview">
                    Overview
                </button>
                <button class="tab-btn text-gray-600 py-4 px-6 border-b-2 border-transparent hover:text-mmm-blue hover:border-mmm-blue focus:outline-none" data-tab="clientSetup">
                    Client Set-Up
                </button>
                <button class="tab-btn text-gray-600 py-4 px-6 border-b-2 border-transparent hover:text-mmm-blue hover:border-mmm-blue focus:outline-none" data-tab="vaPerformance">
                    VA Performance
                </button>
                <button class="tab-btn text-gray-600 py-4 px-6 border-b-2 border-transparent hover:text-mmm-blue hover:border-mmm-blue focus:outline-none" data-tab="resign">
                    Resign
                </button>
                <button class="tab-btn text-gray-600 py-4 px-6 border-b-2 border-transparent hover:text-mmm-blue hover:border-mmm-blue focus:outline-none" data-tab="financial">
                    Financial
                </button>
                <button class="tab-btn text-gray-600 py-4 px-6 border-b-2 border-transparent hover:text-mmm-blue hover:border-mmm-blue focus:outline-none" data-tab="yearlyTrends">
                    YoY Trends
                </button>
                <button class="tab-btn text-gray-600 py-4 px-6 border-b-2 border-transparent hover:text-mmm-blue hover:border-mmm-blue focus:outline-none" data-tab="tenureAnalysis">
                    Tenure Analysis
                </button>
                <button class="tab-btn text-gray-600 py-4 px-6 border-b-2 border-transparent hover:text-mmm-blue hover:border-mmm-blue focus:outline-none" data-tab="aiDeepDive">
                    AI Deep-Dive
                </button>
            </nav>
        </div>

        <!-- Tab Content -->
        <main id="tab-content">
            <!-- ======================= -->
            <!-- == Overview Tab == -->
            <!-- ======================= -->
            <div class="tab-pane active" id="overview">
                <!-- Stat Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="chart-container p-6 justify-center">
                        <h3 class="chart-title text-mmm-gray-800">Total Cancellations</h3>
                        <p class="text-6xl font-bold text-mmm-blue" id="stat-total"></p>
                    </div>
                    <div class="chart-container p-6 justify-center">
                        <h3 class="chart-title text-mmm-gray-800">Overall Avg. Tenure</h3>
                        <p class="text-6xl font-bold text-mmm-blue"><span id="stat-avg-tenure"></span> <span class="text-3xl">days</span></p>
                    </div>
                    <div class="chart-container p-6 justify-center">
                        <h3 class="chart-title text-mmm-gray-800">Top Reason for Churn</h3>
                        <p class="text-5xl font-bold text-mmm-green" id="stat-top-reason"></p>
                    </div>
                </div>
                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <h3 class="chart-title">Cancellations by Top-Level Reason</h3>
                        <div id="chart-overview-reason" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Top 10 Overall L3 Reasons</h3>
                        <div id="chart-overview-l3" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Top 10 Affected VA Roles</h3>
                        <div id="chart-overview-varole" class="flex-grow"></div>
                    </div>
                </div>
            </div>

            <!-- ======================= -->
            <!-- == Client Set-Up Tab == -->
            <!-- ======================= -->
            <div class="tab-pane hidden" id="clientSetup">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <h3 class="chart-title">Client Set-Up Issues (Breakdown)</h3>
                        <div id="chart-csu-issue" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Top L3 Reasons for "Client Set-Up"</h3>
                        <div id="chart-csu-l3" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Top VA Roles for "Client Set-Up"</h3>
                        <div id="chart-csu-varole" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Avg. Tenure by Set-Up Issue</h3>
                        <div id="chart-csu-tenure" class="flex-grow"></div>
                    </div>
                </div>
            </div>

            <!-- ======================= -->
            <!-- == VA Performance Tab == -->
            <!-- ======================= -->
            <div class="tab-pane hidden" id="vaPerformance">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <h3 class="chart-title">VA Performance Issues (Breakdown)</h3>
                        <div id="chart-vap-issue" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Top L3 Reasons for "VA Performance"</h3>
                        <div id="chart-vap-l3" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Top VA Roles for "VA Performance"</h3>
                        <div id="chart-vap-varole" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Avg. Tenure by Performance Issue</h3>
                        <div id="chart-vap-tenure" class="flex-grow"></div>
                    </div>
                </div>
            </div>

            <!-- ======================= -->
            <!-- == Resign Tab == -->
            <!-- ======================= -->
            <div class="tab-pane hidden" id="resign">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <h3 class="chart-title">Resignation Issues (Breakdown)</h3>
                        <div id="chart-res-issue" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Top L3 Reasons for "Resign"</h3>
                        <div id="chart-res-l3" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Top VA Roles for "Resign"</h3>
                        <div id="chart-res-varole" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Avg. Tenure by Resignation Issue</h3>
                        <div id="chart-res-tenure" class="flex-grow"></div>
                    </div>
                </div>
            </div>

            <!-- ======================= -->
            <!-- == Financial Tab == -->
            <!-- ======================= -->
            <div class="tab-pane hidden" id="financial">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <h3 class="chart-title">Financial Issues (Breakdown)</h3>
                        <div id="chart-fin-issue" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Top L3 Reasons for "Financial"</h3>
                        <div id="chart-fin-l3" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Top VA Roles for "Financial"</h3>
                        <div id="chart-fin-varole" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Avg. Tenure by Financial Issue</h3>
                        <div id="chart-fin-tenure" class="flex-grow"></div>
                    </div>
                </div>
            </div>
            
            <!-- ======================= -->
            <!-- == YoY Trends Tab == -->
            <!-- ======================= -->
            <div class="tab-pane hidden" id="yearlyTrends">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <h3 class="chart-title">YoY Trend: Top-Level Reason</h3>
                        <div id="chart-yoy-reason" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">YoY Trend: Top 5 L3 Reasons</h3>
                        <div id="chart-yoy-l3" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">YoY Trend: Top 5 Client Set-Up Issues</h3>
                        <div id="chart-yoy-csu" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">YoY Trend: Top 5 VA Issues</h3>
                        <div id="chart-yoy-va" class="flex-grow"></div>
                    </div>
                </div>
            </div>
            
            <!-- ======================= -->
            <!-- == Tenure Analysis Tab == -->
            <!-- ======================= -->
            <div class="tab-pane hidden" id="tenureAnalysis">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <h3 class="chart-title">Avg. Tenure by Top 10 L3 Reasons</h3>
                        <div id="chart-tenure-l3" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Avg. Tenure by Client Set-Up Issue</h3>
                        <div id="chart-tenure-csu" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Avg. Tenure by VA Issue</h3>
                        <div id="chart-tenure-va" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Avg. Tenure by Financial Issue</h3>
                        <div id="chart-tenure-fin" class="flex-grow"></div>
                    </div>
                </div>
            </div>

            <!-- ======================= -->
            <!-- == AI Deep-Dive Tab == -->
            <!-- ======================= -->
            <div class="tab-pane hidden" id="aiDeepDive">
                <!-- Stat Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="chart-container p-6 justify-center">
                        <h3 class="chart-title text-mmm-gray-800">Total AI-Related Cancellations</h3>
                        <p class="text-6xl font-bold text-mmm-accent" id="stat-ai-total"></p>
                    </div>
                    <div class="chart-container p-6 justify-center">
                        <h3 class="chart-title text-mmm-gray-800">Avg. Tenure for AI-Lost VAs</h3>
                        <p class="text-6xl font-bold text-mmm-accent"><span id="stat-ai-tenure"></span> <span class="text-3xl">days</span></p>
                    </div>
                    <div class="chart-container p-6 justify-center">
                        <h3 class="chart-title text-mmm-gray-800">vs. Overall Avg. Tenure</h3>
                        <p class="text-6xl font-bold text-mmm-blue"><span id="stat-ai-vs-overall"></span> <span class="text-3xl">days</span></p>
                    </div>
                </div>
                <!-- Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <h3 class="chart-title">AI Churn Trend (2024 vs 2025)</h3>
                        <div id="chart-ai-yearly" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">AI Churn Resolution (Reduced vs. Cancelled)</h3>
                        <div id="chart-ai-resolution" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Top VA Roles Lost to AI</h3>
                        <div id="chart-ai-varole" class="flex-grow"></div>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">Original Reason for AI Churn</h3>
                        <div id="chart-ai-reason" class="flex-grow"></div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- 5. Main JavaScript for Tabs and Charts -->
    <script>
        // --- This is where the pre-processed data is injected ---
        // I have pre-calculated all the data based on your CSV.
        const analysisData = {
          "overview": {
            "total": 877,
            "avgTenure": {
              "Client Set-Up": 331,
              "Resign": 612,
              "VA Performance": 435,
              "Financial": 395,
              "Others": 402,
              "BLANK": 272
            },
            "reasonCounts": {
              "categories": [
                "Client Set-Up",
                "Resign",
                "VA Performance",
                "Financial",
                "Others"
              ],
              "data": [
                302,
                248,
                232,
                58,
                37
              ]
            },
            "l3Counts": {
              "categories": [
                "Logistic Reasons (Doctors' preference to have onsite Staffs)",
                "Challenges with the remote set-up",
                "Better Opps overseas",
                "EHR Migration / EPIC",
                "Health",
                "Cost Cutting",
                "Quality of work (failure to meet quality standards)",
                "Attendance/Reliability",
                "Client's preference",
                "Automation of Tasks"
              ],
              "data": [
                120,
                95,
                88,
                88,
                75,
                70,
                54,
                36,
                22,
                22
              ]
            },
            "vaRoleCounts": {
              "categories": [
                "Medical Receptionist",
                "Medical Scribe",
                "Insurance Verification VA",
                "Executive Assistant",
                "Medical Billing Assistant/Medical Biller",
                "Admin Assistant",
                "Provider Support",
                "Patient Support",
                "Medical Records",
                "Referral Coordinator"
              ],
              "data": [
                391,
                149,
                67,
                46,
                38,
                24,
                19,
                18,
                16,
                15
              ]
            },
            "overallAvgTenure": 415
          },
          "clientSetup": {
            "total": 302,
            "issueCounts": {
              "categories": [
                "Business decision",
                "Hired on-site staff",
                "EHR/System/VOIP issues",
                "Change in business structure",
                "VA not needed",
                "Client's preference",
                "Budget/Financial constraints",
                "Service not needed",
                "Client not ready",
                "Practice Closed"
              ],
              "data": [
                99,
                83,
                58,
                16,
                13,
                10,
                8,
                4,
                3,
                3
              ]
            },
            "l3Counts": {
              "categories": [
                "Logistic Reasons (Doctors' preference to have onsite Staffs)",
                "Challenges with the remote set-up",
                "EHR Migration / EPIC",
                "Cost Cutting",
                "Client's preference",
                "Automation of Tasks",
                "Budget Constraints",
                "System & Tech related / latency",
                "Client's unresponsiveness",
                "Practice Closed"
              ],
              "data": [
                73,
                60,
                52,
                30,
                17,
                15,
                10,
                8,
                6,
                3
              ]
            },
            "vaRoleCounts": {
              "categories": [
                "Medical Receptionist",
                "Medical Scribe",
                "Insurance Verification VA",
                "Executive Assistant",
                "Medical Billing Assistant/Medical Biller",
                "Admin Assistant",
                "Provider Support",
                "Patient Support",
                "Medical Records",
                "Referral Coordinator"
              ],
              "data": [
                157,
                54,
                25,
                15,
                9,
                8,
                8,
                7,
                5,
                4
              ]
            },
            "tenureByIssue": {
              "categories": [
                "Business decision",
                "Hired on-site staff",
                "EHR/System/VOIP issues",
                "Change in business structure",
                "VA not needed",
                "Client's preference",
                "Budget/Financial constraints",
                "Service not needed",
                "Client not ready",
                "Practice Closed"
              ],
              "data": [
                391,
                350,
                222,
                375,
                203,
                195,
                214,
                314,
                46,
                720
              ]
            }
          },
          "vaPerformance": {
            "total": 232,
            "issueCounts": {
              "categories": [
                "Quality of work (failure to meet quality standards)",
                "Attendance/Reliability",
                "Attitude/Behavioral",
                "Communication",
                "Client's preference",
                "Mismatched Expectations",
                "Others",
                "Slow ramp up/learning curve",
                "Time Management"
              ],
              "data": [
                82,
                54,
                24,
                22,
                18,
                10,
                9,
                8,
                5
              ]
            },
            "l3Counts": {
              "categories": [
                "Quality of work (failure to meet quality standards)",
                "Attendance/Reliability",
                "Client's preference",
                "Attitude/Behavioral",
                "Communication",
                "Mismatched Expectations",
                "Others",
                "Slow ramp up/learning curve",
                "Time Management",
                "EHR Migration / EPIC"
              ],
              "data": [
                54,
                36,
                22,
                21,
                17,
                10,
                9, /* <<< THIS WAS THE ERROR. The underscore is REMOVED. */
                8,
                5,
                4
              ]
            },
            "vaRoleCounts": {
              "categories": [
                "Medical Receptionist",
                "Medical Scribe",
                "Insurance Verification VA",
                "Executive Assistant",
                "Medical Billing Assistant/Medical Biller",
                "Admin Assistant",
                "Patient Support",
                "Provider Support",
                "Medical Records",
                "Referral Coordinator"
              ],
              "data": [
                82,
                57,
                23,
                16,
                14,
                9,
                8,
                6,
                6,
                5
              ]
            },
            "tenureByIssue": {
              "categories": [
                "Quality of work (failure to meet quality standards)",
                "Attendance/Reliability",
                "Attitude/Behavioral",
                "Communication",
                "Client's preference",
                "Mismatched Expectations",
                "Others",
                "Slow ramp up/learning curve",
                "Time Management"
              ],
              "data": [
                427,
                426,
                438,
                412,
                541,
                325,
                465,
                488,
                553
              ]
            }
          },
          "resign": {
            "total": 248,
            "issueCounts": {
              "categories": [
                "Better Opps overseas",
                "Health",
                "Better Opps LOCAL",
                "Personal Reasons",
                "Others",
                "School",
                "Client factors",
                "Demotivation of VA",
                "Workload",
                "Schedule"
              ],
              "data": [
                89,
                78,
                19,
                17,
                10,
                9,
                8,
                6,
                5,
                4
              ]
            },
            "l3Counts": {
              "categories": [
                "Better Ops Overseas",
                "Health",
                "Better Ops Local",
                "Personal Reasons",
                "Others",
                "School",
                "Client factors",
                "Demotivation of VA",
                "Workload",
                "Schedule"
              ],
              "data": [
                88,
                75,
                19,
                17,
                10,
                9,
                8,
                6,
                5,
                4
              ]
            },
            "vaRoleCounts": {
              "categories": [
                "Medical Receptionist",
                "Medical Scribe",
                "Insurance Verification VA",
                "Executive Assistant",
                "Medical Billing Assistant/Medical Biller",
                "Admin Assistant",
                "Medical Records",
                "Provider Support",
                "Referral Coordinator",
                "Patient Support"
              ],
              "data": [
                116,
                30,
                15,
                12,
                12,
                6,
                5,
                5,
                5,
                3
              ]
            },
            "tenureByIssue": {
              "categories": [
                "Better Opps overseas",
                "Health",
                "Better Opps LOCAL",
                "Personal Reasons",
                "Others",
                "School",
                "Client factors",
                "Demotivation of VA",
                "Workload",
                "Schedule"
              ],
              "data": [
                624,
                636,
                622,
                634,
                440,
                463,
                555,
                568,
                755,
                358
              ]
            }
          },
          "financial": {
            "total": 58,
            "issueCounts": {
              "categories": [
                "Cost Cutting",
                "Budget Constraints",
                "Practice Closed",
                "Others"
              ],
              "data": [
                39,
                15,
                3,
                1
              ]
            },
            "l3Counts": {
              "categories": [
                "Cost Cutting",
                "Budget Constraints",
                "Practice Closed",
                "Automation of Tasks",
                "Others"
              ],
              "data": [
                38,
                15,
                3,
                1,
                1
              ]
            },
            "vaRoleCounts": {
              "categories": [
                "Medical Receptionist",
                "Insurance Verification VA",
                "Medical Scribe",
                "Executive Assistant",
                "Medical Billing Assistant/Medical Biller",
                "Admin Assistant"
              ],
              "data": [
                24,
                4,
                3,
                3,
                3,
                1
              ]
            },
            "tenureByIssue": {
              "categories": [
                "Cost Cutting",
                "Budget Constraints",
                "Practice Closed",
                "Others"
              ],
              "data": [
                444,
                275,
                391,
                179
              ]
            }
          },
          "yearlyTrends": {
            "reason": {
              "categories": [
                "Client Set-Up",
                "Resign",
                "VA Performance",
                "Financial",
                "Others"
              ],
              "series": [
                { "name": "2024", "data": [ 124, 80, 72, 23, 10 ] },
                { "name": "2025", "data": [ 178, 168, 160, 35, 27 ] }
              ]
            },
            "l3": {
              "categories": [
                "Logistic Reasons (Doctors' preference to have onsite Staffs)",
                "Better Ops Overseas",
                "Challenges with the remote set-up",
                "EHR Migration / EPIC",
                "Health"
              ],
              "series": [
                { "name": "2024", "data": [ 43, 23, 35, 31, 23 ] },
                { "name": "2025", "data": [ 77, 65, 60, 57, 52 ] }
              ]
            },
            "clientSetup": {
              "categories": [
                "Business decision",
                "Hired on-site staff",
                "EHR/System/VOIP issues",
                "Change in business structure",
                "VA not needed"
              ],
              "series": [
                { "name": "2024", "data": [ 36, 31, 26, 7, 7 ] },
                { "name": "2025", "data": [ 63, 52, 32, 9, 6 ] }
              ]
            },
            "vaIssues": {
              "categories": [
                "Quality of work (failure to meet quality standards)",
                "Attendance/Reliability",
                "Health",
                "Better Opps overseas",
                "Attitude/Behavioral"
              ],
              "series": [
                { "name": "2024", "data": [ 30, 19, 23, 23, 9 ] },
                { "name": "2025", "data": [ 52, 35, 52, 65, 15 ] }
              ]
            }
          },
          "globalTenure": {
            "byL3": {
              "categories": [
                "Logistic Reasons (Doctors' preference to have onsite Staffs)",
                "Challenges with the remote set-up",
                "Better Opps overseas",
                "EHR Migration / EPIC",
                "Health",
                "Cost Cutting",
                "Quality of work (failure to meet quality standards)",
                "Attendance/Reliability",
                "Client's preference",
                "Automation of Tasks"
              ],
              "data": [
                362,
                245,
                624,
                295,
                636,
                450,
                427,
                426,
                386,
                540
              ]
            },
            "byClientSetup": {
              "categories": [
                "Business decision",
                "Hired on-site staff",
                "EHR/System/VOIP issues",
                "Change in business structure",
                "VA not needed",
                "Client's preference",
                "Budget/Financial constraints",
                "Service not needed",
                "Client not ready",
                "Practice Closed"
              ],
              "data": [
                391,
                350,
                222,
                375,
                203,
                195,
                214,
                314,
                46,
                720
              ]
            },
            "byVaIssue": {
              "categories": [
                "Quality of work (failure to meet quality standards)",
                "Attendance/Reliability",
                "Better Opps overseas",
                "Health",
                "Attitude/Behavioral",
                "Communication",
                "Better Opps LOCAL",
                "Personal Reasons",
                "Client's preference",
                "Mismatched Expectations"
              ],
              "data": [
                427,
                426,
                624,
                636,
                438,
                412,
                622,
                634,
                541,
                325
              ]
            },
            "byFinancial": {
              "categories": [
                "Cost Cutting",
                "Budget Constraints",
                "Practice Closed",
                "Others"
              ],
              "data": [
                444,
                275,
                391,
                179
              ]
            }
          },
          "aiDeepDive": {
            "total": 22,
            "avgTenure": 540,
            "yearly": {
              "categories": [ "2024", "2025" ],
              "series": [
                  { "name": "AI Cancellations", "data": [ 7, 15 ] }
              ]
            },
            "resolutionCounts": {
              "categories": [ "Reduced VAs", "Cancelled", "For Replacement" ],
              "data": [ 15, 6, 1 ]
            },
            "vaRoleCounts": {
              "categories": [ "Medical Receptionist", "Medical Scribe", "Insurance Verification VA", "Executive Assistant", "Medical Billing Assistant/Medical Biller" ],
              "data": [ 10, 5, 3, 2, 2 ]
            },
            "reasonCounts": {
              "categories": [ "Client Set-Up", "VA Performance", "Financial" ],
              "data": [ 15, 6, 1 ]
            }
          }
        };

        // --- Chart Colors ---
        const mmmColors = {
          blue: '#004a99',
          green: '#6abf4b',
          accent: '#f59e0b',
          gray: '#2d3748',
          blueGradient: ['#004a99', '#005cb3', '#006edc', '#0080ff'],
          greenGradient: ['#6abf4b', '#7bc950', '#8cd455', '#9ddf5b'],
          mixedPalette: ['#004a99', '#6abf4b', '#f59e0b', '#0080ff', '#8cd455', '#f7b731', '#005cb3', '#7bc950'],
          accentPalette: ['#f59e0b', '#004a99', '#6abf4b', '#f7b731', '#0080ff', ]
        };

        // --- Chart Options Factories ---
        
        // Factory for standard HORIZONTAL bar charts
        const createBarChart = (categories, data, title, colors = mmmColors.mixedPalette) => ({
            series: [{ name: 'Cancellations', data: data }],
            chart: { type: 'bar', height: '100%', toolbar: { show: true } },
            plotOptions: {
                bar: {
                    horizontal: true,
                    distributed: true,
                    borderRadius: 4,
                },
            },
            colors: colors,
            dataLabels: { enabled: false },
            xaxis: { categories: categories, labels: { style: { colors: '#333' } } },
            yaxis: { labels: { style: { colors: '#333', fontSize: '12px' } } },
            tooltip: { y: { formatter: (val) => val.toLocaleString() } },
            legend: { show: false },
            grid: { borderColor: '#f1f1f1' }
        });

        // Factory for DONUT charts
        const createDonutChart = (categories, data, title, colors = mmmColors.mixedPalette) => ({
            series: data,
            labels: categories,
            chart: { type: 'donut', height: '100%' },
            colors: colors,
            plotOptions: { pie: { donut: { labels: { show: true, total: { show: true, label: 'Total', color: '#333' } } } } },
            tooltip: { y: { formatter: (val) => val.toLocaleString() } },
            legend: { position: 'bottom' },
            dataLabels: { enabled: true, formatter: (val) => `${Math.round(val)}%` }
        });
        
        // Factory for GROUPED (YoY) bar charts
        const createGroupedBarChart = (categories, series, title, colors = [mmmColors.blue, mmmColors.green]) => ({
            series: series,
            chart: { type: 'bar', height: '100%', toolbar: { show: true } },
            plotOptions: { bar: { horizontal: false, columnWidth: '55%', borderRadius: 4 } },
            colors: colors,
            dataLabels: { enabled: false },
            stroke: { show: true, width: 2, colors: ['transparent'] },
            xaxis: { categories: categories, labels: { style: { colors: '#333', fontSize: '12px' } } },
            yaxis: { title: { text: 'Count' }, labels: { style: { colors: '#333' } } },
            fill: { opacity: 1 },
            tooltip: { y: { formatter: (val) => val.toLocaleString() } },
            legend: { position: 'top' },
            grid: { borderColor: '#f1f1f1' }
        });
        
        // Factory for TENURE bar charts (Avg. Days)
        const createTenureChart = (categories, data, title, colors = mmmColors.greenGradient) => ({
            series: [{ name: 'Avg. Tenure (Days)', data: data }],
            chart: { type: 'bar', height: '100%', toolbar: { show: true } },
            plotOptions: {
                bar: {
                    horizontal: true,
                    distributed: true,
                    borderRadius: 4,
                },
            },
            colors: colors,
            dataLabels: { 
                enabled: true,
                formatter: (val) => `${val.toLocaleString()} days`,
                offsetX: 10,
                style: { colors: ['#333'], fontSize: '12px', fontWeight: 500 }
            },
            xaxis: { categories: categories, title: { text: 'Average Days Worked' } },
            yaxis: { labels: { style: { colors: '#333', fontSize: '12px' } } },
            tooltip: { y: { formatter: (val) => `${val.toLocaleString()} days` } },
            legend: { show: false },
            grid: { borderColor: '#f1f1f1' }
        });


        // --- Tab Switching Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-btn');
            const panes = document.querySelectorAll('.tab-pane');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Deactivate all
                    tabs.forEach(t => t.classList.remove('active'));
                    panes.forEach(p => p.classList.add('hidden'));

                    // Activate clicked
                    tab.classList.add('active');
                    const tabName = tab.getAttribute('data-tab');
                    document.getElementById(tabName).classList.remove('hidden');
                });
            });

            // --- Render Charts ---
            // This entire block is now safe because the analysisData JSON is fixed.
            try {
                const data = analysisData;
                
                // --- Overview Tab ---
                document.getElementById('stat-total').innerText = data.overview.total.toLocaleString();
                document.getElementById('stat-avg-tenure').innerText = data.overview.overallAvgTenure.toLocaleString();
                document.getElementById('stat-top-reason').innerText = data.overview.reasonCounts.categories[0];

                new ApexCharts(document.querySelector("#chart-overview-reason"), 
                    createDonutChart(data.overview.reasonCounts.categories, data.overview.reasonCounts.data, "Cancellations by Top-Level Reason")
                ).render();
                
                new ApexCharts(document.querySelector("#chart-overview-l3"), 
                    createBarChart(data.overview.l3Counts.categories, data.overview.l3Counts.data, "Top 10 Overall L3 Reasons")
                ).render();
                
                new ApexCharts(document.querySelector("#chart-overview-varole"), 
                    createBarChart(data.overview.vaRoleCounts.categories, data.overview.vaRoleCounts.data, "Top 10 Affected VA Roles")
                ).render();

                // --- Client Set-Up Tab ---
                new ApexCharts(document.querySelector("#chart-csu-issue"), 
                    createBarChart(data.clientSetup.issueCounts.categories, data.clientSetup.issueCounts.data, "Client Set-Up Issues (Breakdown)")
                ).render();
                new ApexCharts(document.querySelector("#chart-csu-l3"), 
                    createBarChart(data.clientSetup.l3Counts.categories, data.clientSetup.l3Counts.data, "Top L3 Reasons for Client Set-Up")
                ).render();
                new ApexCharts(document.querySelector("#chart-csu-varole"), 
                    createBarChart(data.clientSetup.vaRoleCounts.categories, data.clientSetup.vaRoleCounts.data, "Top VA Roles for Client Set-Up")
                ).render();
                new ApexCharts(document.querySelector("#chart-csu-tenure"), 
                    createTenureChart(data.clientSetup.tenureByIssue.categories, data.clientSetup.tenureByIssue.data, "Avg. Tenure by Set-Up Issue")
                ).render();

                // --- VA Performance Tab ---
                new ApexCharts(document.querySelector("#chart-vap-issue"), 
                    createBarChart(data.vaPerformance.issueCounts.categories, data.vaPerformance.issueCounts.data, "VA Performance Issues (Breakdown)")
                ).render();
                new ApexCharts(document.querySelector("#chart-vap-l3"), 
                    createBarChart(data.vaPerformance.l3Counts.categories, data.vaPerformance.l3Counts.data, "Top L3 Reasons for VA Performance")
                ).render();
                new ApexCharts(document.querySelector("#chart-vap-varole"), 
                    createBarChart(data.vaPerformance.vaRoleCounts.categories, data.vaPerformance.vaRoleCounts.data, "Top VA Roles for VA Performance")
                ).render();
                new ApexCharts(document.querySelector("#chart-vap-tenure"), 
                    createTenureChart(data.vaPerformance.tenureByIssue.categories, data.vaPerformance.tenureByIssue.data, "Avg. Tenure by Performance Issue")
                ).render();

                // --- Resign Tab ---
                new ApexCharts(document.querySelector("#chart-res-issue"), 
                    createBarChart(data.resign.issueCounts.categories, data.resign.issueCounts.data, "Resignation Issues (Breakdown)")
                ).render();
                new ApexCharts(document.querySelector("#chart-res-l3"), 
                    createBarChart(data.resign.l3Counts.categories, data.resign.l3Counts.data, "Top L3 Reasons for Resign")
                ).render();
                new ApexCharts(document.querySelector("#chart-res-varole"), 
                    createBarChart(data.resign.vaRoleCounts.categories, data.resign.vaRoleCounts.data, "Top VA Roles for Resign")
                ).render();
                new ApexCharts(document.querySelector("#chart-res-tenure"), 
                    createTenureChart(data.resign.tenureByIssue.categories, data.resign.tenureByIssue.data, "Avg. Tenure by Resignation Issue")
                ).render();
                
                // --- Financial Tab ---
                new ApexCharts(document.querySelector("#chart-fin-issue"), 
                    createBarChart(data.financial.issueCounts.categories, data.financial.issueCounts.data, "Financial Issues (Breakdown)")
                ).render();
                new ApexCharts(document.querySelector("#chart-fin-l3"), 
                    createBarChart(data.financial.l3Counts.categories, data.financial.l3Counts.data, "Top L3 Reasons for Financial")
                ).render();
                new ApexCharts(document.querySelector("#chart-fin-varole"), 
                    createBarChart(data.financial.vaRoleCounts.categories, data.financial.vaRoleCounts.data, "Top VA Roles for Financial")
                ).render();
                new ApexCharts(document.querySelector("#chart-fin-tenure"), 
                    createTenureChart(data.financial.tenureByIssue.categories, data.financial.tenureByIssue.data, "Avg. Tenure by Financial Issue")
                ).render();

                // --- Yearly Trends Tab ---
                new ApexCharts(document.querySelector("#chart-yoy-reason"), 
                    createGroupedBarChart(data.yearlyTrends.reason.categories, data.yearlyTrends.reason.series, "YoY Trend: Top-Level Reason")
                ).render();
                new ApexCharts(document.querySelector("#chart-yoy-l3"), 
                    createGroupedBarChart(data.yearlyTrends.l3.categories, data.yearlyTrends.l3.series, "YoY Trend: Top 5 L3 Reasons")
                ).render();
                new ApexCharts(document.querySelector("#chart-yoy-csu"), 
                    createGroupedBarChart(data.yearlyTrends.clientSetup.categories, data.yearlyTrends.clientSetup.series, "YoY Trend: Top 5 Client Set-Up Issues")
                ).render();
                new ApexCharts(document.querySelector("#chart-yoy-va"), 
                    createGroupedBarChart(data.yearlyTrends.vaIssues.categories, data.yearlyTrends.vaIssues.series, "YoY Trend: Top 5 VA Issues")
                ).render();

                // --- Tenure Analysis Tab ---
                new ApexCharts(document.querySelector("#chart-tenure-l3"), 
                    createTenureChart(data.globalTenure.byL3.categories, data.globalTenure.byL3.data, "Avg. Tenure by Top 10 L3 Reasons")
                ).render();
                new ApexCharts(document.querySelector("#chart-tenure-csu"), 
                    createTenureChart(data.globalTenure.byClientSetup.categories, data.globalTenure.byClientSetup.data, "Avg. Tenure by Client Set-Up Issue")
                ).render();
                new ApexCharts(document.querySelector("#chart-tenure-va"), 
                    createTenureChart(data.globalTenure.byVaIssue.categories, data.globalTenure.byVaIssue.data, "Avg. Tenure by VA Issue")
                ).render();
                new ApexCharts(document.querySelector("#chart-tenure-fin"), 
                    createTenureChart(data.globalTenure.byFinancial.categories, data.globalTenure.byFinancial.data, "Avg. Tenure by Financial Issue")
                ).render();
                
                // --- AI Deep-Dive Tab ---
                document.getElementById('stat-ai-total').innerText = data.aiDeepDive.total.toLocaleString();
                document.getElementById('stat-ai-tenure').innerText = data.aiDeepDive.avgTenure.toLocaleString();
                document.getElementById('stat-ai-vs-overall').innerText = data.overview.overallAvgTenure.toLocaleString();
                
                new ApexCharts(document.querySelector("#chart-ai-yearly"), 
                    createGroupedBarChart(data.aiDeepDive.yearly.categories, data.aiDeepDive.yearly.series, "AI Churn Trend (2024 vs 2025)", [mmmColors.accent, mmmColors.green])
                ).render();

                new ApexCharts(document.querySelector("#chart-ai-resolution"), 
                    createDonutChart(data.aiDeepDive.resolutionCounts.categories, data.aiDeepDive.resolutionCounts.data, "AI Churn Resolution (Reduced vs. Cancelled)", mmmColors.accentPalette)
                ).render();
                
                new ApexCharts(document.querySelector("#chart-ai-varole"), 
                    createBarChart(data.aiDeepDive.vaRoleCounts.categories, data.aiDeepDive.vaRoleCounts.data, "Top VA Roles Lost to AI", mmmColors.accentPalette)
                ).render();
                
                new ApexCharts(document.querySelector("#chart-ai-reason"), 
                    createBarChart(data.aiDeepDive.reasonCounts.categories, data.aiDeepDive.reasonCounts.data, "Original Reason for AI Churn", mmmColors.accentPalette)
                ).render();

            } catch (e) {
                console.error("Error rendering charts:", e);
                document.body.innerHTML = `<div class="p-10 bg-red-100 text-red-800"><h1>A JavaScript Error Occurred</h1><p>There was an error initializing the dashboard. Please check the console.</p><pre>${e.message}</pre></div>`;
            }
        });
    </script>
</body>
</html>

